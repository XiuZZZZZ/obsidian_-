{
	"nodes":[
		{"id":"c3dca77ddb702f20","type":"text","text":"```\nClassMethod sendToDHCHisInterface(CarryNO As %String, UserID As %String, UserLocID As %String = \"\") As %String\n{\n\ts carryId=$O(^Nur.NurseCarryI(\"CarryNo\",\" \"_CarryNO,\"\"))\n\tq:carryId=\"\" 0\n\ts Id=\"\"\n\tfor {\n\t\ts Id=$o(^Nur.NurseCarryDetailI(\"CarryDR\",\" \"_carryId,Id)) q:Id=\"\"\n\t\ts labNo=$lg(^Nur.NurseCarryDetailD(Id),12)\n\t\tcontinue:labNo=\"\"\n\t\tif (labNo'[\"-\") {\n\t\t\ts ord=\"\" \n\t\t\tfor {  \n\t\t\t\ts ord=$O(^OEORD(0,\"EpisNo\",labNo,ord)) q:ord=\"\"\n\t\t\t \ts chl=\"\"\n\t\t\t \tfor{  \n\t\t\t \t\ts chl=$O(^OEORD(0,\"EpisNo\",labNo,ord,chl)) q:chl=\"\"\n\t\t\t\t \tcontinue:'$$filterOrd()\n\t\t\t\t    d ##class(Nur.NIS.Service.Base.OrderHandle).sendToDHCHisInterface(ord_\"||\"_chl, \"ST\", \"\", UserID, UserLocID)\n\t\t\t\t}\n\t\t\t}\n\t\t\ti $O(^OEORD(0,\"EpisNo\",labNo,\"\"))=\"\" {\n\t\t\t\ts placerNo=$O(^OEORDi(0,\"PlacerNo\",labNo,\"\"))\n\t\t\t\tcontinue:placerNo=\"\"\n\t\t\t\ts ord=$O(^OEORDi(0,\"PlacerNo\",labNo,placerNo,\"\"))\n\t\t\t\tcontinue:ord=\"\"\n\t\t\t\ts chl=\"\"\n\t\t\t\tfor{\n\t\t\t\t\ts chl=$O(^OEORDi(0,\"PlacerNo\",labNo,placerNo,ord,chl)) q:chl=\"\"\t\n\t\t\t\t \tcontinue:'$$filterOrd()\n\t\t\t\t    d ##class(Nur.NIS.Service.Base.OrderHandle).sendToDHCHisInterface(ord_\"||\"_chl, \"ST\", \"\", UserID, UserLocID)\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\ts ord=$p(labNo,\"-\",1)\n\t\t\ts CarryLabDesc=\"\"\n\t\t \ts chl=$p(labNo,\"-\",2)\n\t\t \tcontinue:'$$filterOrd()\n\t\t    d ##class(Nur.NIS.Service.Base.OrderHandle).sendToDHCHisInterface(ord_\"||\"_chl, \"ST\", \"\", UserID, UserLocID)\n\t\t}\n\t}\n\tq 0\nfilterOrd()\n\ts arcimId=$p($g(^OEORD(ord,\"I\",chl,1)),\"^\",2)\n\tq:arcimId=\"\" 0\n\ts ordStatusId=$P($g(^OEORD(ord,\"I\",chl,1)),\"^\",13)\n    s ordStat=$p($g(^OEC(\"OSTAT\",ordStatusId)),\"^\",1)\n    q:(ordStat=\"C\")!(ordStat=\"D\")!(ordStat=\"U\")\n\tq 1\n}\n```","x":-520,"y":179,"width":1000,"height":1021},
		{"id":"19462d11368db5b3","type":"text","text":"```\n/// Creator:      songchao\n/// CreateDate:   2018.6.21\n/// Description:  运送单出科\n/// Input:        CarryNO：出库单号,ContainerNo：出库容器编码，TransUserId：运送用户工号，UserId：护士用户工号，UserLocCode：护士所属科室ID\n/// Return:       \n/// Other:        ##Class(Nur.HISUI.SpecManage).outLocCarrySheet()\nClassMethod outLocCarrySheet(CarryNO As %String, ContainerNo As %String, TransUserID As %String, UserID As %String, UserLocID)\n{\n\ts ^tempsc(\"outLocCarrySheet\")=$lb(CarryNO, ContainerNo , TransUserID , UserID , UserLocID)\n\ts CarryNO= $tr(CarryNO,\" \",\"\")\n\ts objRet=##class(%ArrayOfDataTypes).%New()\n\ts ret=##class(Nur.NurseCarry).ExchangeTransNo(CarryNO, ContainerNo , TransUserID , UserID , UserLocID)\n\ti ret[\"@\" d\n\t.d objRet.SetAt($p(ret,\"@\",1),\"success\")\n\t.d objRet.SetAt($p(ret,\"@\",2),\"errInfo\")\n\t.i $p(ret,\"@\",1)=0 job ..sendToDHCHisInterface(CarryNO,UserID , UserLocID)\n\tq ##class(Nur.JSON).EncodeByWrite(objRet)\n}\n```","x":-520,"y":-440,"width":1000,"height":409},
		{"id":"d3ef0e4991252126","type":"text","text":"```\n/// Description:： 交接出库\n/// Input：        TransNo：出库单号,ContainerNo：出库容器编码，TransUserId：运送用户工号，UserId：护士用户工号，UserLocCode：护士所属科室ID\n/// Output：       SQLCODE\n/// Return：       0：插入成功\n/// Others：\t\t无\nClassMethod ExchangeTransNo(TransNo As %String, ContainerNo As %String, TransUserId As %String, UserId As %String, UserLocCode = \"\") As %String\n{\n\tS TransNo=$G(TransNo),ContainerNo=$G(ContainerNo),TransUserId=$G(TransUserId),UserLocCode=$G(UserLocCode)\n    q:TransNo=\"\" \"1@未选中出库单号\"\n    s CarryRowId=$O(^Nur.NurseCarryI(\"CarryNo\",\" \"_TransNo,\"\"))\n\tq:CarryRowId=\"\" \"2@无此运送单号！\"\n\ts object=##class(Nur.NurseCarry).%OpenId(CarryRowId)\n\ts Status=object.Status\n\tq:Status'=\"C\" \"3@状态不为'建单'的不可交接！\"\n\ts object.TransContainer=ContainerNo\n\ts object.TransUser=TransUserId\n\ts object.UserId=UserId\n\ts object.TransDate=+$h\n\ts object.TransTime=$p($h,\",\",2)\n\ts object.Status=\"S\"\n\td object.%Save()\n\tq \"0@交接成功！\"\n}\n```","x":560,"y":-440,"width":1000,"height":520},
		{"id":"f69e58d96d626601","x":-520,"y":-620,"width":720,"height":80,"type":"text","text":"后台方法：Nur.HISUI.SpecManage  outLocCarrySheet"}
	],
	"edges":[]
}